# Internationalization (i18n) – Phase 1 Overview

This document summarizes the database i18n infrastructure added in Milestone 2 – Phase 1.

- Translation JSONB columns added to master data tables with GIN indexes
- Non-breaking: original `name`, `description`, and `content` columns are retained
- Existing English data migrated into JSONB under `en`
- Profiles table includes `preferred_language` with validation and index
- Helper utilities provided for reading/writing translations in code

## Affected Tables and Columns

- categories: `name_translations`, `description_translations`
- sampradayas: `name_translations`, `description_translations`
- languages: `name_translations`
- service_radius_options: `name_translations`, `description_translations`
- experience_levels: `name_translations`, `description_translations`
- terms: `content_translations`
- profiles: `preferred_language`

Indexes created for every new JSONB column (GIN) and for `profiles.preferred_language`.

## Helper Functions

Location: `apps/web/lib/translations/db-helpers.ts`

- `getTranslation(translations, locale, fallback='en')`
- `buildTranslation(englishText, translations?)`
- `updateTranslation(existing, locale, text)`
- `hasTranslation(translations, locale)`
- `getTranslationCoverage(items, locale, fields)`

Types are available at `apps/web/lib/translations/types.ts`.

## Rollback

A rollback script is available at `infra/supabase/21_i18n_rollback.sql` to drop the added columns and indexes and remove `preferred_language` if necessary.

## Testing

Unit tests for helper functions are under `apps/web/__tests__/translations/db-helpers.spec.ts` (Vitest).

## Next Steps (Phase 2)

- Integrate `next-intl`, add `/messages` structure, middleware, hooks, and a Language Selector component.
- Extract UI strings into `messages/en.json` (no Kannada content yet).
